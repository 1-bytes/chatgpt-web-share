{"openapi":"3.0.2","info":{"title":"FastAPI","version":"0.1.0"},"paths":{"/auth/login":{"post":{"tags":["auth"],"summary":"Auth:Jwt.Login","operationId":"auth_jwt_login_auth_login_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_auth_jwt_login_auth_login_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"400":{"description":"Bad Request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorModel"},"examples":{"LOGIN_BAD_CREDENTIALS":{"summary":"Bad credentials or the user is inactive.","value":{"detail":"LOGIN_BAD_CREDENTIALS"}},"LOGIN_USER_NOT_VERIFIED":{"summary":"The user is not verified.","value":{"detail":"LOGIN_USER_NOT_VERIFIED"}}}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/logout":{"post":{"tags":["auth"],"summary":"Auth:Jwt.Logout","operationId":"auth_jwt_logout_auth_logout_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"401":{"description":"Missing token or inactive user."}},"security":[{"APIKeyCookie":[]}]}},"/auth/register":{"post":{"tags":["auth"],"summary":"Register","operationId":"register_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user":{"get":{"tags":["user"],"summary":"Get All Users","operationId":"get_all_users_user_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user/me":{"get":{"tags":["user"],"summary":"Get Me","operationId":"get_me_user_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]},"patch":{"tags":["user"],"summary":"Update Me","operationId":"update_me_user_me_patch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user/{user_id}":{"get":{"tags":["user"],"summary":"Admin Get User","operationId":"admin_get_user_user__user_id__get","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"delete":{"tags":["user"],"summary":"Admin Delete User","operationId":"admin_delete_user_user__user_id__delete","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"patch":{"tags":["user"],"summary":"Admin Update User","operationId":"admin_update_user_user__user_id__patch","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdateAdmin"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user/{user_id}/setting":{"patch":{"tags":["user"],"summary":"Admin Update User Setting","operationId":"admin_update_user_setting_user__user_id__setting_patch","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserSettingSchema"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv":{"get":{"tags":["conversation"],"summary":"Get All Conversations","description":"返回自己的有效会话\n对于管理员，返回所有对话，并可以指定是否只返回有效会话","operationId":"get_all_conversations_conv_get","parameters":[{"required":false,"schema":{"title":"Fetch All","type":"boolean","default":false},"name":"fetch_all","in":"query"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"delete":{"tags":["conversation"],"summary":"Delete All Conversation","operationId":"delete_all_conversation_conv_delete","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}":{"get":{"tags":["conversation"],"summary":"Get Conversation History","operationId":"get_conversation_history_conv__conversation_id__get","parameters":[{"required":true,"schema":{"title":"Conversation Id","type":"string"},"name":"conversation_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"delete":{"tags":["conversation"],"summary":"Delete Conversation","description":"remove conversation from database and chatgpt server","operationId":"delete_conversation_conv__conversation_id__delete","parameters":[{"required":true,"schema":{"title":"Conversation Id","type":"string"},"name":"conversation_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"patch":{"tags":["conversation"],"summary":"Update Conversation Title","operationId":"update_conversation_title_conv__conversation_id__patch","parameters":[{"required":true,"schema":{"title":"Conversation Id","type":"string"},"name":"conversation_id","in":"path"},{"required":true,"schema":{"title":"Title","type":"string"},"name":"title","in":"query"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}/vanish":{"delete":{"tags":["conversation"],"summary":"Vanish Conversation","operationId":"vanish_conversation_conv__conversation_id__vanish_delete","parameters":[{"required":true,"schema":{"title":"Conversation Id","type":"string"},"name":"conversation_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}/assign/{username}":{"patch":{"tags":["conversation"],"summary":"Assign Conversation","operationId":"assign_conversation_conv__conversation_id__assign__username__patch","parameters":[{"required":true,"schema":{"title":"Username","type":"string"},"name":"username","in":"path"},{"required":true,"schema":{"title":"Conversation Id","type":"string"},"name":"conversation_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}/gen_title":{"patch":{"tags":["conversation"],"summary":"Generate Conversation Title","operationId":"generate_conversation_title_conv__conversation_id__gen_title_patch","parameters":[{"required":true,"schema":{"title":"Conversation Id","type":"string"},"name":"conversation_id","in":"path"},{"required":true,"schema":{"title":"Message Id","type":"string"},"name":"message_id","in":"query"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/chat/avaliable-models":{"get":{"tags":["chat"],"summary":"Get Avaliable Models","operationId":"get_avaliable_models_chat_avaliable_models_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/info":{"get":{"tags":["system"],"summary":"Get System Info","operationId":"get_system_info_system_info_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/request_statistics":{"get":{"tags":["system"],"summary":"Get Request Statistics","operationId":"get_request_statistics_system_request_statistics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/server_logs":{"post":{"tags":["system"],"summary":"Get Server Logs","operationId":"get_server_logs_system_server_logs_post","requestBody":{"content":{"application/json":{"schema":{"title":"Options","allOf":[{"$ref":"#/components/schemas/LogFilterOptions"}],"default":{"max_lines":100}}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/config":{"get":{"tags":["system"],"summary":"Get Config","operationId":"get_config_system_config_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]},"patch":{"tags":["system"],"summary":"Update Config","operationId":"update_config_system_config_patch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConfigUpdate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/status":{"get":{"tags":["status"],"summary":"Get Server Status","description":"普通用户获取服务器状态","operationId":"get_server_status_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}}},"components":{"schemas":{"ApiChatModels":{"title":"ApiChatModels","enum":["gpt-3.5-turbo","gpt-4"],"description":"An enumeration."},"Body_auth_jwt_login_auth_login_post":{"title":"Body_auth_jwt_login_auth_login_post","required":["username","password"],"type":"object","properties":{"grant_type":{"title":"Grant Type","pattern":"password","type":"string"},"username":{"title":"Username","type":"string"},"password":{"title":"Password","type":"string"},"scope":{"title":"Scope","type":"string","default":""},"client_id":{"title":"Client Id","type":"string"},"client_secret":{"title":"Client Secret","type":"string"}}},"ChatGPTSetting":{"title":"ChatGPTSetting","type":"object","properties":{"is_plus_account":{"title":"Is Plus Account","type":"boolean","default":false},"chatgpt_base_url":{"title":"Chatgpt Base Url","type":"string"},"ask_timeout":{"title":"Ask Timeout","type":"integer","default":600}}},"ConfigRead":{"title":"ConfigRead","required":["chatgpt","credentials_exist"],"type":"object","properties":{"chatgpt":{"$ref":"#/components/schemas/ChatGPTSetting"},"credentials_exist":{"title":"Credentials Exist","type":"object","additionalProperties":{"type":"boolean"}}}},"ConfigUpdate":{"title":"ConfigUpdate","required":["chatgpt","credentials"],"type":"object","properties":{"chatgpt":{"$ref":"#/components/schemas/ChatGPTSetting"},"credentials":{"$ref":"#/components/schemas/Credentials"}}},"Credentials":{"title":"Credentials","type":"object","properties":{"chatgpt_account_access_token":{"title":"Chatgpt Account Access Token","type":"string"},"chatgpt_account_username":{"title":"Chatgpt Account Username","type":"string"},"chatgpt_account_password":{"title":"Chatgpt Account Password","type":"string"},"openai_api_key":{"title":"Openai Api Key","type":"string"}}},"ErrorModel":{"title":"ErrorModel","required":["detail"],"type":"object","properties":{"detail":{"title":"Detail","anyOf":[{"type":"string"},{"type":"object","additionalProperties":{"type":"string"}}]}}},"HTTPValidationError":{"title":"HTTPValidationError","type":"object","properties":{"detail":{"title":"Detail","type":"array","items":{"$ref":"#/components/schemas/ValidationError"}}}},"LogFilterOptions":{"title":"LogFilterOptions","type":"object","properties":{"max_lines":{"title":"Max Lines","type":"integer","default":100},"exclude_keywords":{"title":"Exclude Keywords","type":"array","items":{"type":"string"}}}},"RequestStatistics":{"title":"RequestStatistics","required":["request_counts_interval","request_counts","ask_records"],"type":"object","properties":{"request_counts_interval":{"title":"Request Counts Interval","type":"integer"},"request_counts":{"title":"Request Counts","type":"object","additionalProperties":{"type":"array","items":{}}},"ask_records":{"title":"Ask Records","type":"array","items":{}}}},"RevChatAskLimits":{"title":"RevChatAskLimits","required":["max_conv_count","total_count","per_model_count"],"type":"object","properties":{"max_conv_count":{"title":"Max Conv Count","type":"integer"},"total_count":{"title":"Total Count","type":"integer"},"per_model_count":{"title":"Per Model Count","type":"object","additionalProperties":{"type":"integer"}}}},"RevChatModels":{"title":"RevChatModels","enum":["gpt-4","text-davinci-002-render-sha","text-davinci-002-render-paid",""],"description":"An enumeration."},"RevChatStatus":{"title":"RevChatStatus","enum":["asking","queueing","idling"],"description":"An enumeration."},"RevChatTimeLimits":{"title":"RevChatTimeLimits","required":["time_window_limits","available_time_range_in_day"],"type":"object","properties":{"time_window_limits":{"title":"Time Window Limits","type":"object","additionalProperties":{"type":"array","items":{"type":"array","items":{"type":"integer"}}}},"available_time_range_in_day":{"title":"Available Time Range In Day","type":"object","additionalProperties":{"type":"array","items":{"type":"integer"}}}}},"RevConversationSchema":{"title":"RevConversationSchema","type":"object","properties":{"id":{"title":"Id","type":"integer","default":-1},"conversation_id":{"title":"Conversation Id","type":"string","format":"uuid"},"title":{"title":"Title","type":"string"},"user_id":{"title":"User Id","type":"integer"},"is_valid":{"title":"Is Valid","type":"boolean","default":true},"model_name":{"$ref":"#/components/schemas/RevChatModels"},"created_time":{"title":"Created Time","type":"string","format":"date-time"},"active_time":{"title":"Active Time","type":"string","format":"date-time"}}},"ServerStatusSchema":{"title":"ServerStatusSchema","type":"object","properties":{"active_user_in_5m":{"title":"Active User In 5M","type":"integer"},"active_user_in_1h":{"title":"Active User In 1H","type":"integer"},"active_user_in_1d":{"title":"Active User In 1D","type":"integer"},"is_chatbot_busy":{"title":"Is Chatbot Busy","type":"boolean"},"chatbot_waiting_count":{"title":"Chatbot Waiting Count","type":"integer"}}},"SystemInfo":{"title":"SystemInfo","required":["startup_time","total_user_count","total_conversation_count","valid_conversation_count"],"type":"object","properties":{"startup_time":{"title":"Startup Time","type":"number"},"total_user_count":{"title":"Total User Count","type":"integer"},"total_conversation_count":{"title":"Total Conversation Count","type":"integer"},"valid_conversation_count":{"title":"Valid Conversation Count","type":"integer"}}},"UserCreate":{"title":"UserCreate","required":["email","password","username","nickname"],"type":"object","properties":{"email":{"title":"Email","type":"string","format":"email"},"password":{"title":"Password","type":"string"},"is_active":{"title":"Is Active","type":"boolean","default":true},"is_superuser":{"title":"Is Superuser","type":"boolean","default":false},"is_verified":{"title":"Is Verified","type":"boolean","default":false},"username":{"title":"Username","type":"string"},"nickname":{"title":"Nickname","type":"string"},"avatar":{"title":"Avatar","type":"string"},"remark":{"title":"Remark","type":"string"},"setting":{"title":"Setting","allOf":[{"$ref":"#/components/schemas/UserSettingSchema"}],"default":{"can_use_revchatgpt":true,"revchatgpt_available_models":["text-davinci-002-render-sha","gpt-4"],"revchatgpt_ask_limits":{"max_conv_count":1,"total_count":0,"per_model_count":{"text-davinci-002-render-sha":0,"gpt-4":0}},"revchatgpt_time_limits":{"time_window_limits":{"text-davinci-002-render-sha":[],"gpt-4":[]},"available_time_range_in_day":{}},"can_use_openai_api":true,"openai_api_credits":0.0,"openai_api_available_models":["gpt-3.5-turbo","gpt-4"],"can_use_custom_openai_api":true}}}},"UserRead":{"title":"UserRead","required":["id","email","is_active","is_superuser","is_verified","username","nickname","rev_chat_status","created_time","setting"],"type":"object","properties":{"id":{"title":"Id","type":"integer"},"email":{"title":"Email","type":"string","format":"email"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"username":{"title":"Username","type":"string"},"nickname":{"title":"Nickname","type":"string"},"rev_chat_status":{"$ref":"#/components/schemas/RevChatStatus"},"active_time":{"title":"Active Time","type":"string","format":"date-time"},"created_time":{"title":"Created Time","type":"string","format":"date-time"},"avatar":{"title":"Avatar","type":"string"},"setting":{"$ref":"#/components/schemas/UserSettingSchema"}},"description":"Base User model."},"UserReadAdmin":{"title":"UserReadAdmin","required":["id","email","is_active","is_superuser","is_verified","username","nickname","rev_chat_status","created_time","setting"],"type":"object","properties":{"id":{"title":"Id","type":"integer"},"email":{"title":"Email","type":"string","format":"email"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"username":{"title":"Username","type":"string"},"nickname":{"title":"Nickname","type":"string"},"rev_chat_status":{"$ref":"#/components/schemas/RevChatStatus"},"active_time":{"title":"Active Time","type":"string","format":"date-time"},"created_time":{"title":"Created Time","type":"string","format":"date-time"},"avatar":{"title":"Avatar","type":"string"},"setting":{"$ref":"#/components/schemas/UserSettingSchema"},"remark":{"title":"Remark","type":"string"}},"description":"Base User model."},"UserSettingSchema":{"title":"UserSettingSchema","required":["can_use_revchatgpt","revchatgpt_available_models","revchatgpt_ask_limits","revchatgpt_time_limits","can_use_openai_api","openai_api_credits","openai_api_available_models","can_use_custom_openai_api"],"type":"object","properties":{"id":{"title":"Id","type":"integer"},"user_id":{"title":"User Id","type":"integer"},"can_use_revchatgpt":{"title":"Can Use Revchatgpt","type":"boolean"},"revchatgpt_available_models":{"type":"array","items":{"$ref":"#/components/schemas/RevChatModels"}},"revchatgpt_ask_limits":{"$ref":"#/components/schemas/RevChatAskLimits"},"revchatgpt_time_limits":{"$ref":"#/components/schemas/RevChatTimeLimits"},"can_use_openai_api":{"title":"Can Use Openai Api","type":"boolean"},"openai_api_credits":{"title":"Openai Api Credits","type":"number"},"openai_api_available_models":{"type":"array","items":{"$ref":"#/components/schemas/ApiChatModels"}},"can_use_custom_openai_api":{"title":"Can Use Custom Openai Api","type":"boolean"},"custom_openai_api_key":{"title":"Custom Openai Api Key","type":"string"}}},"UserUpdate":{"title":"UserUpdate","type":"object","properties":{"password":{"title":"Password","type":"string"},"email":{"title":"Email","type":"string"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"nickname":{"title":"Nickname","type":"string"},"avatar":{"title":"Avatar","type":"string"}}},"UserUpdateAdmin":{"title":"UserUpdateAdmin","type":"object","properties":{"password":{"title":"Password","type":"string"},"email":{"title":"Email","type":"string"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"nickname":{"title":"Nickname","type":"string"},"avatar":{"title":"Avatar","type":"string"},"username":{"title":"Username","type":"string"},"remark":{"title":"Remark","type":"string"}}},"ValidationError":{"title":"ValidationError","required":["loc","msg","type"],"type":"object","properties":{"loc":{"title":"Location","type":"array","items":{"anyOf":[{"type":"string"},{"type":"integer"}]}},"msg":{"title":"Message","type":"string"},"type":{"title":"Error Type","type":"string"}}}},"securitySchemes":{"APIKeyCookie":{"type":"apiKey","in":"cookie","name":"user_auth"}}}}
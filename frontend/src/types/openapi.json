{"openapi":"3.0.2","info":{"title":"FastAPI","version":"0.1.0"},"paths":{"/auth/login":{"post":{"tags":["auth"],"summary":"Auth:Jwt.Login","operationId":"auth_jwt_login_auth_login_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_auth_jwt_login_auth_login_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"400":{"description":"Bad Request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorModel"},"examples":{"LOGIN_BAD_CREDENTIALS":{"summary":"Bad credentials or the user is inactive.","value":{"detail":"LOGIN_BAD_CREDENTIALS"}},"LOGIN_USER_NOT_VERIFIED":{"summary":"The user is not verified.","value":{"detail":"LOGIN_USER_NOT_VERIFIED"}}}}}},"204":{"description":"No Content"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/logout":{"post":{"tags":["auth"],"summary":"Auth:Jwt.Logout","operationId":"auth_jwt_logout_auth_logout_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"401":{"description":"Missing token or inactive user."},"204":{"description":"No Content"}},"security":[{"APIKeyCookie":[]}]}},"/auth/register":{"post":{"tags":["auth"],"summary":"Register","description":"注册时不能指定setting，使用默认setting","operationId":"register_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user":{"get":{"tags":["user"],"summary":"Get All Users","operationId":"get_all_users_user_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user/me":{"get":{"tags":["user"],"summary":"Get Me","operationId":"get_me_user_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]},"patch":{"tags":["user"],"summary":"Update Me","operationId":"update_me_user_me_patch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user/{user_id}":{"get":{"tags":["user"],"summary":"Admin Get User","operationId":"admin_get_user_user__user_id__get","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"delete":{"tags":["user"],"summary":"Admin Delete User","operationId":"admin_delete_user_user__user_id__delete","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"patch":{"tags":["user"],"summary":"Admin Update User","operationId":"admin_update_user_user__user_id__patch","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdateAdmin"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/user/{user_id}/setting":{"patch":{"tags":["user"],"summary":"Admin Update User Setting","operationId":"admin_update_user_setting_user__user_id__setting_patch","parameters":[{"required":true,"schema":{"title":"User Id","type":"integer"},"name":"user_id","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserSettingSchema"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv":{"get":{"tags":["conversation"],"summary":"Get My Conversations","description":"返回自己的有效会话","operationId":"get_my_conversations_conv_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]},"delete":{"tags":["conversation"],"summary":"Delete All Conversation","operationId":"delete_all_conversation_conv_delete","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/all":{"get":{"tags":["conversation"],"summary":"Get All Conversations","operationId":"get_all_conversations_conv_all_get","parameters":[{"required":false,"schema":{"title":"Valid Only","type":"boolean","default":true},"name":"valid_only","in":"query"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}":{"get":{"tags":["conversation"],"summary":"Get Conversation History","operationId":"get_conversation_history_conv__conversation_id__get","parameters":[{"required":true,"schema":{"title":"Conversation Id","anyOf":[{"type":"string"},{"type":"string","format":"uuid"}]},"name":"conversation_id","in":"path"},{"required":false,"schema":{"title":"Refresh","type":"boolean","default":false},"name":"refresh","in":"query"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"delete":{"tags":["conversation"],"summary":"Delete Conversation","description":"软删除：标记为 invalid 并且从 chatgpt 账号中删除会话，但不会删除 mongodb 中的历史记录","operationId":"delete_conversation_conv__conversation_id__delete","parameters":[{"required":true,"schema":{"title":"Conversation Id","anyOf":[{"type":"string"},{"type":"string","format":"uuid"}]},"name":"conversation_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]},"patch":{"tags":["conversation"],"summary":"Update Conversation Title","operationId":"update_conversation_title_conv__conversation_id__patch","parameters":[{"required":true,"schema":{"title":"Conversation Id","anyOf":[{"type":"string"},{"type":"string","format":"uuid"}]},"name":"conversation_id","in":"path"},{"required":true,"schema":{"title":"Title","type":"string"},"name":"title","in":"query"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}/vanish":{"delete":{"tags":["conversation"],"summary":"Vanish Conversation","description":"硬删除：删除数据库和账号中的对话和历史记录","operationId":"vanish_conversation_conv__conversation_id__vanish_delete","parameters":[{"required":true,"schema":{"title":"Conversation Id","anyOf":[{"type":"string"},{"type":"string","format":"uuid"}]},"name":"conversation_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}/assign/{username}":{"patch":{"tags":["conversation"],"summary":"Assign Conversation","operationId":"assign_conversation_conv__conversation_id__assign__username__patch","parameters":[{"required":true,"schema":{"title":"Username","type":"string"},"name":"username","in":"path"},{"required":true,"schema":{"title":"Conversation Id","anyOf":[{"type":"string"},{"type":"string","format":"uuid"}]},"name":"conversation_id","in":"path"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/conv/{conversation_id}/gen_title":{"patch":{"tags":["conversation"],"summary":"Generate Conversation Title","operationId":"generate_conversation_title_conv__conversation_id__gen_title_patch","parameters":[{"required":true,"schema":{"title":"Conversation Id","anyOf":[{"type":"string"},{"type":"string","format":"uuid"}]},"name":"conversation_id","in":"path"},{"required":true,"schema":{"title":"Message Id","type":"string"},"name":"message_id","in":"query"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/chat/__schema_types":{"get":{"tags":["chat"],"summary":" Predict Schema Types","description":"只用来让 openapi 自动生成 schema，并不实际调用","operationId":"_predict_schema_types_chat___schema_types_get","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AskRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/system/info":{"get":{"tags":["system"],"summary":"Get System Info","operationId":"get_system_info_system_info_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/stats/request":{"get":{"tags":["system"],"summary":"Get Request Statistics","operationId":"get_request_statistics_system_stats_request_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/logs/server":{"post":{"tags":["system"],"summary":"Get Server Logs","operationId":"get_server_logs_system_logs_server_post","requestBody":{"content":{"application/json":{"schema":{"title":"Options","allOf":[{"$ref":"#/components/schemas/LogFilterOptions"}],"default":{"max_lines":100}}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/config":{"get":{"tags":["system"],"summary":"Get Config","operationId":"get_config_system_config_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]},"put":{"tags":["system"],"summary":"Update Config","operationId":"update_config_system_config_put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConfigModel"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/system/credentials":{"get":{"tags":["system"],"summary":"Get Credentials","operationId":"get_credentials_system_credentials_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]},"put":{"tags":["system"],"summary":"Update Credentials","operationId":"update_credentials_system_credentials_put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CredentialsModel"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"APIKeyCookie":[]}]}},"/status":{"get":{"tags":["status"],"summary":"Get Server Status","description":"普通用户获取服务器状态","operationId":"get_server_status_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string"}}}}},"security":[{"APIKeyCookie":[]}]}}},"components":{"schemas":{"APISetting":{"title":"APISetting","type":"object","properties":{"openai_base_url":{"title":"Openai Base Url","type":"string","default":"https://api.openai.com/v1/"},"connect_timeout":{"title":"Connect Timeout","minimum":1.0,"type":"integer","default":10},"read_timeout":{"title":"Read Timeout","minimum":1.0,"type":"integer","default":10}}},"ApiChatMessageMetadata":{"title":"ApiChatMessageMetadata","type":"object","properties":{"prompt_tokens":{"title":"Prompt Tokens","type":"integer"},"completion_tokens":{"title":"Completion Tokens","type":"integer"},"finish_reason":{"title":"Finish Reason","type":"string"}}},"ApiConversationSchema":{"title":"ApiConversationSchema","type":"object","properties":{"id":{"title":"Id","type":"integer","default":-1},"type":{"title":"Type","enum":["api"],"type":"string","default":"api"},"conversation_id":{"title":"Conversation Id","type":"string","format":"uuid"},"title":{"title":"Title","type":"string"},"user_id":{"title":"User Id","type":"integer"},"is_valid":{"title":"Is Valid","type":"boolean","default":true},"current_model":{"$ref":"#/components/schemas/ChatModel"},"create_time":{"title":"Create Time","type":"string","format":"date-time"},"update_time":{"title":"Update Time","type":"string","format":"date-time"}}},"AskLimitSetting":{"title":"AskLimitSetting","required":["max_conv_count","total_ask_count","per_model_ask_count"],"type":"object","properties":{"max_conv_count":{"title":"Max Conv Count","type":"integer"},"total_ask_count":{"title":"Total Ask Count","type":"integer"},"per_model_ask_count":{"title":"per_model_ask_count","allOf":[{"$ref":"#/components/schemas/ChatModelDict_int_"}]}}},"AskRequest":{"title":"AskRequest","required":["type","new_conversation","model","content"],"type":"object","properties":{"type":{"$ref":"#/components/schemas/ChatSourceTypes"},"new_conversation":{"title":"New Conversation","type":"boolean"},"new_title":{"title":"New Title","type":"string"},"conversation_id":{"title":"Conversation Id","type":"string","format":"uuid"},"parent":{"title":"Parent","type":"string","format":"uuid"},"model":{"$ref":"#/components/schemas/ChatModel"},"api_context_message_count":{"title":"Api Context Message Count","type":"integer","default":-1},"content":{"title":"Content","type":"string"}}},"AskResponse":{"title":"AskResponse","required":["type"],"type":"object","properties":{"type":{"$ref":"#/components/schemas/AskResponseType"},"tip":{"title":"Tip","type":"string"},"conversation_id":{"title":"Conversation Id","type":"string","format":"uuid"},"message":{"$ref":"#/components/schemas/ChatMessage"},"error_detail":{"title":"Error Detail","type":"string"}}},"AskResponseType":{"title":"AskResponseType","enum":["waiting","queueing","message","error"],"type":"string","description":"An enumeration."},"AskTimeLimits":{"title":"AskTimeLimits","required":["time_window_limits","available_time_range_in_day"],"type":"object","properties":{"time_window_limits":{"title":"time_window_limits","allOf":[{"$ref":"#/components/schemas/ChatModelDict_list_list_int___"}]},"available_time_range_in_day":{"title":"available_time_range_in_day","allOf":[{"$ref":"#/components/schemas/ChatModelDict_Union_list_int___NoneType__"}]}}},"AuthSetting":{"title":"AuthSetting","type":"object","properties":{"jwt_secret":{"title":"Jwt Secret","type":"string","default":"MODIFY_THIS_TO_RANDOM_SECRET"},"jwt_lifetime_seconds":{"title":"Jwt Lifetime Seconds","minimum":1.0,"type":"integer","default":86400},"cookie_max_age":{"title":"Cookie Max Age","minimum":1.0,"type":"integer","default":86400},"cookie_name":{"title":"Cookie Name","type":"string","default":"user_auth"},"user_secret":{"title":"User Secret","type":"string","default":"MODIFY_THIS_TO_RANDOM_SECRET"}}},"BaseConversationSchema":{"title":"BaseConversationSchema","required":["type"],"type":"object","properties":{"id":{"title":"Id","type":"integer","default":-1},"type":{"$ref":"#/components/schemas/ChatSourceTypes"},"conversation_id":{"title":"Conversation Id","type":"string","format":"uuid"},"title":{"title":"Title","type":"string"},"user_id":{"title":"User Id","type":"integer"},"is_valid":{"title":"Is Valid","type":"boolean","default":true},"current_model":{"$ref":"#/components/schemas/ChatModel"},"create_time":{"title":"Create Time","type":"string","format":"date-time"},"update_time":{"title":"Update Time","type":"string","format":"date-time"}}},"Body_auth_jwt_login_auth_login_post":{"title":"Body_auth_jwt_login_auth_login_post","required":["username","password"],"type":"object","properties":{"grant_type":{"title":"Grant Type","pattern":"password","type":"string"},"username":{"title":"Username","type":"string"},"password":{"title":"Password","type":"string"},"scope":{"title":"Scope","type":"string","default":""},"client_id":{"title":"Client Id","type":"string"},"client_secret":{"title":"Client Secret","type":"string"}}},"ChatMessage":{"title":"ChatMessage","required":["role","children","content"],"type":"object","properties":{"id":{"title":"Id","type":"string","format":"uuid"},"role":{"title":"Role","type":"string"},"model":{"title":"Model","anyOf":[{"$ref":"#/components/schemas/ChatModel"},{"type":"string"}]},"create_time":{"title":"Create Time","type":"string","format":"date-time"},"parent":{"title":"Parent","type":"string","format":"uuid"},"children":{"title":"Children","type":"array","items":{"type":"string","format":"uuid"}},"content":{"title":"Content","type":"string"},"rev_metadata":{"$ref":"#/components/schemas/RevChatMessageMetadata"},"api_metadata":{"$ref":"#/components/schemas/ApiChatMessageMetadata"}}},"ChatModel":{"title":"ChatModel","enum":["gpt_3_5","gpt_4"],"type":"string","description":"An enumeration."},"ChatModelDict_Union_list_int___NoneType__":{"title":"ChatModelDict[Union[list[int], NoneType]]","type":"object","properties":{"gpt_3_5":{"title":"Gpt 3 5","type":"array","items":{"type":"integer"}},"gpt_4":{"title":"Gpt 4","type":"array","items":{"type":"integer"}}}},"ChatModelDict_int_":{"title":"ChatModelDict[int]","required":["gpt_3_5","gpt_4"],"type":"object","properties":{"gpt_3_5":{"title":"Gpt 3 5","type":"integer"},"gpt_4":{"title":"Gpt 4","type":"integer"}}},"ChatModelDict_list_list_int___":{"title":"ChatModelDict[list[list[int]]]","required":["gpt_3_5","gpt_4"],"type":"object","properties":{"gpt_3_5":{"title":"Gpt 3 5","type":"array","items":{"type":"array","items":{"type":"integer"}}},"gpt_4":{"title":"Gpt 4","type":"array","items":{"type":"array","items":{"type":"integer"}}}}},"ChatSourceTypes":{"title":"ChatSourceTypes","enum":["rev","api"],"type":"string","description":"An enumeration."},"ChatTypeDict_AskLimitSetting_":{"title":"ChatTypeDict[AskLimitSetting]","required":["rev","api"],"type":"object","properties":{"rev":{"$ref":"#/components/schemas/AskLimitSetting"},"api":{"$ref":"#/components/schemas/AskLimitSetting"}}},"ChatTypeDict_AskTimeLimits_":{"title":"ChatTypeDict[AskTimeLimits]","required":["rev","api"],"type":"object","properties":{"rev":{"$ref":"#/components/schemas/AskTimeLimits"},"api":{"$ref":"#/components/schemas/AskTimeLimits"}}},"ChatTypeDict_bool_":{"title":"ChatTypeDict[bool]","required":["rev","api"],"type":"object","properties":{"rev":{"title":"Rev","type":"boolean"},"api":{"title":"Api","type":"boolean"}}},"ChatTypeDict_list_api.enums.ChatModel__":{"title":"ChatTypeDict[list[api.enums.ChatModel]]","required":["rev","api"],"type":"object","properties":{"rev":{"type":"array","items":{"$ref":"#/components/schemas/ChatModel"}},"api":{"type":"array","items":{"$ref":"#/components/schemas/ChatModel"}}}},"CommonSetting":{"title":"CommonSetting","type":"object","properties":{"print_sql":{"title":"Print Sql","type":"boolean","default":false},"create_initial_admin_user":{"title":"Create Initial Admin User","type":"boolean","default":true},"initial_admin_user_username":{"title":"Initial Admin User Username","type":"string","default":"admin"},"initial_admin_user_password":{"title":"Initial Admin User Password","type":"string","default":"password"},"sync_conversations_on_startup":{"title":"Sync Conversations On Startup","type":"boolean","default":true},"sync_conversations_regularly":{"title":"Sync Conversations Regularly","type":"boolean","default":true}}},"ConfigModel":{"title":"ConfigModel","type":"object","properties":{"common":{"title":"Common","allOf":[{"$ref":"#/components/schemas/CommonSetting"}],"default":{"print_sql":false,"create_initial_admin_user":true,"initial_admin_user_username":"admin","initial_admin_user_password":"password","sync_conversations_on_startup":true,"sync_conversations_regularly":true}},"http":{"title":"Http","allOf":[{"$ref":"#/components/schemas/HttpSetting"}],"default":{"host":"127.0.0.1","port":8000,"cors_allow_origins":["http://localhost","http://127.0.0.1"]}},"data":{"title":"Data","allOf":[{"$ref":"#/components/schemas/DataSetting"}],"default":{"data_dir":"./data","database_url":"sqlite+aiosqlite:///data/database.db","mongodb_url":"mongodb://cws:password@localhost:27017","run_migration":false}},"auth":{"title":"Auth","allOf":[{"$ref":"#/components/schemas/AuthSetting"}],"default":{"jwt_secret":"MODIFY_THIS_TO_RANDOM_SECRET","jwt_lifetime_seconds":86400,"cookie_max_age":86400,"cookie_name":"user_auth","user_secret":"MODIFY_THIS_TO_RANDOM_SECRET"}},"revchatgpt":{"title":"Revchatgpt","allOf":[{"$ref":"#/components/schemas/RevChatGPTSetting"}],"default":{"is_plus_account":false,"ask_timeout":600}},"api":{"title":"Api","allOf":[{"$ref":"#/components/schemas/APISetting"}],"default":{"openai_base_url":"https://api.openai.com/v1/","connect_timeout":10,"read_timeout":10}},"log":{"title":"Log","allOf":[{"$ref":"#/components/schemas/LogSetting"}],"default":{"log_dir":"logs","console_log_level":"INFO"}},"stats":{"title":"Stats","allOf":[{"$ref":"#/components/schemas/StatsSetting"}],"default":{"request_counter_time_window":2592000,"request_counts_interval":1800,"ask_log_time_window":604800}}}},"ConversationHistoryDocument":{"title":"ConversationHistoryDocument","required":["type","title","create_time","update_time","mapping","current_node"],"type":"object","properties":{"_id":{"title":" Id","type":"string","format":"uuid"},"type":{"title":"Type","enum":["rev","api"],"type":"string"},"title":{"title":"Title","type":"string"},"create_time":{"title":"Create Time","type":"string","format":"date-time"},"update_time":{"title":"Update Time","type":"string","format":"date-time"},"mapping":{"title":"Mapping","type":"object","additionalProperties":{"$ref":"#/components/schemas/ChatMessage"}},"current_node":{"title":"Current Node","type":"string","format":"uuid"},"current_model":{"title":"Current Model","anyOf":[{"$ref":"#/components/schemas/ChatModel"},{"type":"string"}]}},"description":"Document Mapping class.\n\nFields:\n\n- `id` - MongoDB document ObjectID \"_id\" field.\nMapped to the PydanticObjectId class\n\nInherited from:\n\n- Pydantic BaseModel\n- [UpdateMethods](https://roman-right.github.io/beanie/api/interfaces/#aggregatemethods)"},"CredentialsModel":{"title":"CredentialsModel","type":"object","properties":{"chatgpt_access_token":{"title":"Chatgpt Access Token","type":"string"},"openai_api_key":{"title":"Openai Api Key","type":"string"}}},"DataSetting":{"title":"DataSetting","type":"object","properties":{"data_dir":{"title":"Data Dir","type":"string","default":"./data"},"database_url":{"title":"Database Url","type":"string","default":"sqlite+aiosqlite:///data/database.db"},"mongodb_url":{"title":"Mongodb Url","type":"string","default":"mongodb://cws:password@localhost:27017"},"run_migration":{"title":"Run Migration","type":"boolean","default":false}}},"ErrorModel":{"title":"ErrorModel","required":["detail"],"type":"object","properties":{"detail":{"title":"Detail","anyOf":[{"type":"string"},{"type":"object","additionalProperties":{"type":"string"}}]}}},"HTTPValidationError":{"title":"HTTPValidationError","type":"object","properties":{"detail":{"title":"Detail","type":"array","items":{"$ref":"#/components/schemas/ValidationError"}}}},"HttpSetting":{"title":"HttpSetting","type":"object","properties":{"host":{"title":"Host","type":"string","default":"127.0.0.1"},"port":{"title":"Port","maximum":65535.0,"minimum":1.0,"type":"integer","default":8000},"cors_allow_origins":{"title":"Cors Allow Origins","type":"array","items":{"type":"string"},"default":["http://localhost","http://127.0.0.1"]}}},"LogFilterOptions":{"title":"LogFilterOptions","type":"object","properties":{"max_lines":{"title":"Max Lines","type":"integer","default":100},"exclude_keywords":{"title":"Exclude Keywords","type":"array","items":{"type":"string"}}}},"LogSetting":{"title":"LogSetting","type":"object","properties":{"log_dir":{"title":"Log Dir","type":"string","default":"logs"},"console_log_level":{"title":"Console Log Level","enum":["INFO","DEBUG","WARNING"],"type":"string","default":"INFO"}}},"RequestStatistics":{"title":"RequestStatistics","required":["request_counts_interval","request_counts","ask_records"],"type":"object","properties":{"request_counts_interval":{"title":"Request Counts Interval","type":"integer"},"request_counts":{"title":"Request Counts","type":"object","additionalProperties":{"type":"array","items":{}}},"ask_records":{"title":"Ask Records","type":"array","items":{}}}},"RevChatGPTSetting":{"title":"RevChatGPTSetting","type":"object","properties":{"is_plus_account":{"title":"Is Plus Account","type":"boolean","default":false},"chatgpt_base_url":{"title":"Chatgpt Base Url","type":"string"},"ask_timeout":{"title":"Ask Timeout","minimum":1.0,"type":"integer","default":600}}},"RevChatMessageMetadata":{"title":"RevChatMessageMetadata","type":"object","properties":{"finish_details":{"title":"Finish Details","type":"object"},"weight":{"title":"Weight","type":"number"},"end_turn":{"title":"End Turn","type":"boolean"}}},"RevChatStatus":{"title":"RevChatStatus","enum":["asking","queueing","idling"],"type":"string","description":"An enumeration."},"RevConversationSchema":{"title":"RevConversationSchema","type":"object","properties":{"id":{"title":"Id","type":"integer","default":-1},"type":{"title":"Type","enum":["rev"],"type":"string","default":"rev"},"conversation_id":{"title":"Conversation Id","type":"string","format":"uuid"},"title":{"title":"Title","type":"string"},"user_id":{"title":"User Id","type":"integer"},"is_valid":{"title":"Is Valid","type":"boolean","default":true},"current_model":{"$ref":"#/components/schemas/ChatModel"},"create_time":{"title":"Create Time","type":"string","format":"date-time"},"update_time":{"title":"Update Time","type":"string","format":"date-time"}}},"ServerStatusSchema":{"title":"ServerStatusSchema","type":"object","properties":{"active_user_in_5m":{"title":"Active User In 5M","type":"integer"},"active_user_in_1h":{"title":"Active User In 1H","type":"integer"},"active_user_in_1d":{"title":"Active User In 1D","type":"integer"},"is_chatbot_busy":{"title":"Is Chatbot Busy","type":"boolean"},"chatbot_waiting_count":{"title":"Chatbot Waiting Count","type":"integer"}}},"StatsSetting":{"title":"StatsSetting","type":"object","properties":{"request_counter_time_window":{"title":"Request Counter Time Window","type":"integer","default":2592000},"request_counts_interval":{"title":"Request Counts Interval","type":"integer","default":1800},"ask_log_time_window":{"title":"Ask Log Time Window","type":"integer","default":604800}}},"SystemInfo":{"title":"SystemInfo","required":["startup_time","total_user_count","total_conversation_count","valid_conversation_count"],"type":"object","properties":{"startup_time":{"title":"Startup Time","type":"number"},"total_user_count":{"title":"Total User Count","type":"integer"},"total_conversation_count":{"title":"Total Conversation Count","type":"integer"},"valid_conversation_count":{"title":"Valid Conversation Count","type":"integer"}}},"UserCreate":{"title":"UserCreate","required":["email","password","username","nickname"],"type":"object","properties":{"email":{"title":"Email","type":"string","format":"email"},"password":{"title":"Password","type":"string"},"is_active":{"title":"Is Active","type":"boolean","default":true},"is_superuser":{"title":"Is Superuser","type":"boolean","default":false},"is_verified":{"title":"Is Verified","type":"boolean","default":false},"username":{"title":"Username","type":"string"},"nickname":{"title":"Nickname","type":"string"},"avatar":{"title":"Avatar","type":"string"},"remark":{"title":"Remark","type":"string"}}},"UserRead":{"title":"UserRead","required":["id","email","is_active","is_superuser","is_verified","username","nickname","rev_chat_status","create_time","setting"],"type":"object","properties":{"id":{"title":"Id","type":"integer"},"email":{"title":"Email","type":"string","format":"email"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"username":{"title":"Username","type":"string"},"nickname":{"title":"Nickname","type":"string"},"rev_chat_status":{"$ref":"#/components/schemas/RevChatStatus"},"last_active_time":{"title":"Last Active Time","type":"string","format":"date-time"},"create_time":{"title":"Create Time","type":"string","format":"date-time"},"avatar":{"title":"Avatar","type":"string"},"setting":{"$ref":"#/components/schemas/UserSettingSchema"}},"description":"Base User model."},"UserReadAdmin":{"title":"UserReadAdmin","required":["id","email","is_active","is_superuser","is_verified","username","nickname","rev_chat_status","create_time","setting"],"type":"object","properties":{"id":{"title":"Id","type":"integer"},"email":{"title":"Email","type":"string","format":"email"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"username":{"title":"Username","type":"string"},"nickname":{"title":"Nickname","type":"string"},"rev_chat_status":{"$ref":"#/components/schemas/RevChatStatus"},"last_active_time":{"title":"Last Active Time","type":"string","format":"date-time"},"create_time":{"title":"Create Time","type":"string","format":"date-time"},"avatar":{"title":"Avatar","type":"string"},"setting":{"$ref":"#/components/schemas/UserSettingSchema"},"remark":{"title":"Remark","type":"string"}},"description":"Base User model."},"UserSettingSchema":{"title":"UserSettingSchema","required":["allow_chat_type","available_models","ask_count_limits","ask_time_limits","allow_custom_openai_api"],"type":"object","properties":{"id":{"title":"Id","type":"integer"},"user_id":{"title":"User Id","type":"integer"},"allow_chat_type":{"title":"allow_chat_type","allOf":[{"$ref":"#/components/schemas/ChatTypeDict_bool_"}]},"available_models":{"title":"available_models","allOf":[{"$ref":"#/components/schemas/ChatTypeDict_list_api.enums.ChatModel__"}]},"ask_count_limits":{"title":"ask_count_limits","allOf":[{"$ref":"#/components/schemas/ChatTypeDict_AskLimitSetting_"}]},"ask_time_limits":{"title":"ask_time_limits","allOf":[{"$ref":"#/components/schemas/ChatTypeDict_AskTimeLimits_"}]},"api_credits":{"title":"Api Credits","type":"number","description":"Credits for OpenAI API, not support unlimited (-1)","default":0.0},"allow_custom_openai_api":{"title":"Allow Custom Openai Api","type":"boolean"},"custom_openai_api_url":{"title":"Custom Openai Api Url","type":"string"},"custom_openai_api_key":{"title":"Custom Openai Api Key","type":"string"}}},"UserUpdate":{"title":"UserUpdate","type":"object","properties":{"password":{"title":"Password","type":"string"},"email":{"title":"Email","type":"string"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"nickname":{"title":"Nickname","type":"string"},"avatar":{"title":"Avatar","type":"string"}}},"UserUpdateAdmin":{"title":"UserUpdateAdmin","type":"object","properties":{"password":{"title":"Password","type":"string"},"email":{"title":"Email","type":"string"},"is_active":{"title":"Is Active","type":"boolean"},"is_superuser":{"title":"Is Superuser","type":"boolean"},"is_verified":{"title":"Is Verified","type":"boolean"},"nickname":{"title":"Nickname","type":"string"},"avatar":{"title":"Avatar","type":"string"},"username":{"title":"Username","type":"string"},"remark":{"title":"Remark","type":"string"}}},"ValidationError":{"title":"ValidationError","required":["loc","msg","type"],"type":"object","properties":{"loc":{"title":"Location","type":"array","items":{"anyOf":[{"type":"string"},{"type":"integer"}]}},"msg":{"title":"Message","type":"string"},"type":{"title":"Error Type","type":"string"}}}},"securitySchemes":{"APIKeyCookie":{"type":"apiKey","in":"cookie","name":"user_auth"}}}}